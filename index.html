<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Teacher Chase Game</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    font-family: Arial, sans-serif;
    background: #111;
    color: #eee;
  }
  canvas {
    display: block;
    background: #222;
  }
  #hud {
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 10;
  }
  #jail-bar-container {
    width: 200px;
    height: 20px;
    border: 2px solid #fff;
    margin-top: 10px;
    border-radius: 5px;
    overflow: hidden;
  }
  #jail-bar {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #f00, #ff0);
    transition: width 0.2s linear;
  }
</style>
</head>
<body>

<div id="hud">
  <p>Level: <span id="level">1</span></p>
  <p>High Score: <span id="high-score">0</span></p>
  <div id="jail-bar-container">
    <div id="jail-bar"></div>
  </div>
</div>

<audio id="tick-sound">
  <source src="https://www.soundjay.com/button/beep-07.wav" type="audio/wav">
</audio>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// HUD elements
const levelDisplay = document.getElementById('level');
const highScoreDisplay = document.getElementById('high-score');
const jailBar = document.getElementById('jail-bar');
const tickSound = document.getElementById('tick-sound');

let currentLevel = 1;
let highScore = localStorage.getItem('highScore') || 0;
highScoreDisplay.textContent = highScore;

// Player
let player = { x: canvas.width/2, y: canvas.height/2, size: 30, speed: 6 };

// Teacher
let teacher = { x: 100, y: 100, size: 30, speed: 3 };

// Controls
let keys = {};
window.addEventListener('keydown', e => keys[e.key] = true);
window.addEventListener('keyup', e => keys[e.key] = false);

// Game loop
function update() {
  // Player movement
  if (keys['ArrowUp'] || keys['w']) player.y -= player.speed;
  if (keys['ArrowDown'] || keys['s']) player.y += player.speed;
  if (keys['ArrowLeft'] || keys['a']) player.x -= player.speed;
  if (keys['ArrowRight'] || keys['d']) player.x += player.speed;

  // Teacher chases player
  const dx = player.x - teacher.x;
  const dy = player.y - teacher.y;
  const dist = Math.hypot(dx, dy);
  if (dist > 0) {
    teacher.x += (dx / dist) * teacher.speed;
    teacher.y += (dy / dist) * teacher.speed;
  }

  // Check collision
  if (dist < (player.size + teacher.size)/2) {
    startJailTimer();
  }
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Player
  ctx.fillStyle = '#0f0';
  ctx.fillRect(player.x - player.size/2, player.y - player.size/2, player.size, player.size);

  // Teacher
  ctx.fillStyle = '#f00';
  ctx.fillRect(teacher.x - teacher.size/2, teacher.y - teacher.size/2, teacher.size, teacher.size);

  requestAnimationFrame(draw);
}

// Jail timer
let jailActive = false;
function startJailTimer() {
  if (jailActive) return;
  jailActive = true;

  let time = 9;
  let elapsed = 0;
  jailBar.style.width = '0%';

  const interval = setInterval(() => {
    elapsed++;
    const progress = (elapsed / time) * 100;
    jailBar.style.width = progress + '%';
    tickSound.currentTime = 0;
    tickSound.play();

    if (elapsed >= time) {
      clearInterval(interval);
      jailActive = false;
      // Ask formula question
      const answer = prompt("What is 2 + 2?");
      if (answer != '4') {
        alert("Wrong! Back to jail!");
        startJailTimer(); // repeat
      } else {
        alert("Correct! Continue!");
        // Level up
        currentLevel++;
        if (currentLevel > 10) currentLevel = 10;
        levelDisplay.textContent = currentLevel;
        if (currentLevel > highScore) {
          highScore = currentLevel;
          localStorage.setItem('highScore', highScore);
          highScoreDisplay.textContent = highScore;
        }
      }
    }
  }, 1000);
}

// Mobile touch controls
canvas.addEventListener('touchmove', function(e) {
  const touch = e.touches[0];
  player.x = touch.clientX;
  player.y = touch.clientY;
}, { passive: false });

function gameLoop() {
  update();
  requestAnimationFrame(gameLoop);
}

draw();
gameLoop();
</script>

</body>
</html>
